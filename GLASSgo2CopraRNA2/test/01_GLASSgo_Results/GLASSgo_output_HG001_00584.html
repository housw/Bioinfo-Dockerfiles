
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <script src="https://cdn.rawgit.com/eligrey/canvas-toBlob.js/f1a01896135ab378aa5c0118eadd81da55e698d8/canvas-toBlob.js"> </script>
    <script src="https://cdn.rawgit.com/eligrey/FileSaver.js/e9d941381475b5df8b7d7691013401e171014e89/FileSaver.min.js"></script>

    <title>Tree Example</title>

    <style>

        html,body{
            height:100%;
            margin:0;
            overflow:hidden;
        }

        svg{
            width:100%;
            height:100%;
        }

        input[type="file"]{
            position:fixed;
            top:1em;
            left:1em;
        }

        .node {
            cursor: pointer;
        }

        .node circle {
          fill: #fff;
          stroke: steelblue;
          stroke-width: 3px;
        }

        .node text {
          font: 12px sans-serif;
        }

        .link {
          fill: none;
          stroke: #ccc;
          stroke-width: 2px;
        }

    </style>

  </head>


<body>

  <!--<div>
      <button id='saveButton'>Export my D3 visualization to PNG</button>
  </div> -->

  <!-- Dateiupload -->
  <!-- <input id="get-tree-data" type='file' accept='application/json' /> -->

  <div id="treeviz"
      style="width:100%; height:100%;border:solid;border-width:1px;">
  </div>

  <!-- load the d3.js library -->
  <script src="http://d3js.org/d3.v3.min.js"></script>

  <script>

      var treeData =
[
  {
    "name": "1:root{299}",
    "parent": "null",
    "value": "21.787436746896134",
    "type": "lightgrey",
    "level": "lightgrey",
    "children": [
      {
        "name": "131567:cellular organisms{299}",
        "parent": "1:root",
        "value": "21.787436746896134",
        "type": "lightgrey",
        "level": "lightgrey",
        "children": [
          {
            "name": "2:Bacteria{299}",
            "parent": "131567:cellular organisms",
            "value": "21.787436746896134",
            "type": "lightgrey",
            "level": "lightgrey",
            "children": [
              {
                "name": "1783272:Terrabacteria group{299}",
                "parent": "2:Bacteria",
                "value": "21.787436746896134",
                "type": "lightgrey",
                "level": "lightgrey",
                "children": [
                  {
                    "name": "1239:Firmicutes{299}",
                    "parent": "1783272:Terrabacteria group",
                    "value": "21.787436746896134",
                    "type": "lightgrey",
                    "level": "lightgrey",
                    "children": [
                      {
                        "name": "1737404:Tissierellia{1}",
                        "parent": "1239:Firmicutes",
                        "value": "1.26",
                        "type": "lightgrey",
                        "level": "lightgrey",
                        "children": [
                          {
                            "name": "1737405:Tissierellales{1}",
                            "parent": "1737404:Tissierellia",
                            "value": "1.26",
                            "type": "lightgrey",
                            "level": "lightgrey",
                            "children": [
                              {
                                "name": "1737406:Tissierellaceae{1}",
                                "parent": "1737405:Tissierellales",
                                "value": "1.26",
                                "type": "lightgrey",
                                "level": "lightgrey",
                                "children": [
                                  {
                                    "name": "45497:[Clostridium] ultunense{1}",
                                    "parent": "1737406:Tissierellaceae",
                                    "value": "1.26",
                                    "type": "lightgrey",
                                    "level": "lightgrey",
                                    "children": [
                                      {
                                        "name": "1288971:[Clostridium] ultunense Esp{1}",
                                        "parent": "45497:[Clostridium] ultunense",
                                        "value": "1.26",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "186801:Clostridia{5}",
                        "parent": "1239:Firmicutes",
                        "value": "2.8174456516497353",
                        "type": "lightgrey",
                        "level": "lightgrey",
                        "children": [
                          {
                            "name": "186802:Clostridiales{5}",
                            "parent": "186801:Clostridia",
                            "value": "2.8174456516497353",
                            "type": "lightgrey",
                            "level": "lightgrey",
                            "children": [
                              {
                                "name": "2304686:Hungateiclostridiaceae{1}",
                                "parent": "186802:Clostridiales",
                                "value": "1.26",
                                "type": "lightgrey",
                                "level": "lightgrey",
                                "children": [
                                  {
                                    "name": "1508657:Ruminiclostridium{1}",
                                    "parent": "2304686:Hungateiclostridiaceae",
                                    "value": "1.26",
                                    "type": "lightgrey",
                                    "level": "lightgrey",
                                    "children": [
                                      {
                                        "name": "1521:Ruminiclostridium cellulolyticum{1}",
                                        "parent": "1508657:Ruminiclostridium",
                                        "value": "1.26",
                                        "type": "lightgrey",
                                        "level": "lightgrey",
                                        "children": [
                                          {
                                            "name": "394503:Ruminiclostridium cellulolyticum H10{1}",
                                            "parent": "1521:Ruminiclostridium cellulolyticum",
                                            "value": "1.26",
                                            "type": "lightgrey",
                                            "level": "lightgrey"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              },
                              {
                                "name": "31979:Clostridiaceae{4}",
                                "parent": "186802:Clostridiales",
                                "value": "2.52",
                                "type": "lightgrey",
                                "level": "lightgrey",
                                "children": [
                                  {
                                    "name": "1485:Clostridium{4}",
                                    "parent": "31979:Clostridiaceae",
                                    "value": "2.52",
                                    "type": "lightgrey",
                                    "level": "lightgrey",
                                    "children": [
                                      {
                                        "name": "1520:Clostridium beijerinckii{3}",
                                        "parent": "1485:Clostridium",
                                        "value": "2.1823840175367852",
                                        "type": "lightgrey",
                                        "level": "lightgrey",
                                        "children": [
                                          {
                                            "name": "1428454:Clostridium beijerinckii NRRL B-598{1}",
                                            "parent": "1520:Clostridium beijerinckii",
                                            "value": "1.26",
                                            "type": "lightgrey",
                                            "level": "lightgrey"
                                          }
                                        ]
                                      },
                                      {
                                        "name": "217159:Clostridium carboxidivorans{1}",
                                        "parent": "1485:Clostridium",
                                        "value": "1.26",
                                        "type": "lightgrey",
                                        "level": "lightgrey",
                                        "children": [
                                          {
                                            "name": "536227:Clostridium carboxidivorans P7{1}",
                                            "parent": "217159:Clostridium carboxidivorans",
                                            "value": "1.26",
                                            "type": "lightgrey",
                                            "level": "lightgrey"
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "91061:Bacilli{293}",
                        "parent": "1239:Firmicutes",
                        "value": "21.56772588846585",
                        "type": "lightgrey",
                        "level": "lightgrey",
                        "children": [
                          {
                            "name": "1385:Bacillales{293}",
                            "parent": "91061:Bacilli",
                            "value": "21.56772588846585",
                            "type": "lightgrey",
                            "level": "lightgrey",
                            "children": [
                              {
                                "name": "90964:Staphylococcaceae{293}",
                                "parent": "1385:Bacillales",
                                "value": "21.56772588846585",
                                "type": "lightgrey",
                                "level": "lightgrey",
                                "children": [
                                  {
                                    "name": "1279:Staphylococcus{293}",
                                    "parent": "90964:Staphylococcaceae",
                                    "value": "21.56772588846585",
                                    "type": "lightgrey",
                                    "level": "lightgrey",
                                    "children": [
                                      {
                                        "name": "1280:Staphylococcus aureus{228}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "19.02558277688229",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "1281:Staphylococcus carnosus{2}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "1.7819090885900999",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "1282:Staphylococcus epidermidis{13}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "4.542994607084626",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "1283:Staphylococcus haemolyticus{5}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "2.8174456516497353",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "1286:Staphylococcus simulans{1}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "1.26",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "1288:Staphylococcus xylosus{4}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "2.52",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "1290:Staphylococcus hominis{2}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "1.7819090885900999",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "1292:Staphylococcus warneri{1}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "1.26",
                                        "type": "lightgrey",
                                        "level": "lightgrey",
                                        "children": [
                                          {
                                            "name": "1194526:Staphylococcus warneri SG1{1}",
                                            "parent": "1292:Staphylococcus warneri",
                                            "value": "1.26",
                                            "type": "lightgrey",
                                            "level": "lightgrey"
                                          }
                                        ]
                                      },
                                      {
                                        "name": "1294:Staphylococcus muscae{1}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "1.26",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "1715860:Staphylococcus sp. AntiMn-1{1}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "1.26",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "214473:Staphylococcus nepalensis{2}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "1.7819090885900999",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "246432:Staphylococcus equorum{3}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "2.1823840175367852",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "28035:Staphylococcus lugdunensis{13}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "4.542994607084626",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "29382:Staphylococcus cohnii{1}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "1.26",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "29385:Staphylococcus saprophyticus{1}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "1.26",
                                        "type": "lightgrey",
                                        "level": "lightgrey",
                                        "children": [
                                          {
                                            "name": "147452:Staphylococcus saprophyticus subsp. saprophyticus{1}",
                                            "parent": "29385:Staphylococcus saprophyticus",
                                            "value": "1.26",
                                            "type": "lightgrey",
                                            "level": "lightgrey",
                                            "children": [
                                              {
                                                "name": "342451:Staphylococcus saprophyticus subsp. saprophyticus ATCC 15305{1}",
                                                "parent": "147452:Staphylococcus saprophyticus subsp. saprophyticus",
                                                "value": "1.26",
                                                "type": "lightgrey",
                                                "level": "lightgrey"
                                              }
                                            ]
                                          }
                                        ]
                                      },
                                      {
                                        "name": "29388:Staphylococcus capitis{4}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "2.52",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "308354:Staphylococcus simiae{1}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "1.26",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "45972:Staphylococcus pasteuri{2}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "1.7819090885900999",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "61015:Staphylococcus succinus{1}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "1.26",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "70255:Staphylococcus condimenti{2}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "1.7819090885900999",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "70258:Staphylococcus piscifermentans{1}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "1.26",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      },
                                      {
                                        "name": "985002:Staphylococcus argenteus{4}",
                                        "parent": "1279:Staphylococcus",
                                        "value": "2.52",
                                        "type": "lightgrey",
                                        "level": "lightgrey"
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  }
];
        var margin = {top: 20, right: 120, bottom: 20, left: 120},
            width = 650 - margin.right - margin.left,
            height = 500 - margin.top - margin.bottom;


        var i = 0,
            duration = 750,
            rectW = 60,
            rectH = 30;
            //root;

        var tree = d3.layout.tree()
            .separation(function separation(a,b) {
                return a.parent == b.parent ? 1 : 0.5;
            })
            .nodeSize([50, 0]);


        var diagonal = d3.svg.diagonal()
            .projection(function(d) {
                return [d.y, d.x];
            });


        var zoom = d3.behavior.zoom()
            .scaleExtent([0.1, 10])
            .on("zoom", zoomed);

        var drag = d3.behavior.drag()
            .origin(function(d) { return d; })
            .on("dragstart", dragstarted)
            .on("drag", dragged)
            .on("dragend", dragended);


        var svg = d3.select("#treeviz").append("svg")
            .attr("width", width + margin.right + margin.left)
            .attr("height", height + margin.top + margin.bottom)
            .call(zoom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        root = treeData[0];
        root.x0 = height;
        root.y0 = 0;
        update(root);
        d3.select(self.frameElement).style("height", "500px");

        function update(source) {

          // Compute the new tree layout.
          var nodes = tree.nodes(root).reverse(),
              links = tree.links(nodes);

          // Normalize for fixed-depth.
          nodes.forEach(function(d) { d.y = d.depth * 320; });

          // Update the nodes…
          var node = svg.selectAll("g.node")
              .data(nodes, function(d) { return d.id || (d.id = ++i); });

          // Enter any new nodes at the parent's previous position.
          var nodeEnter = node.enter().append("g")
              .attr("class", "node")
              .attr("transform", function(d) { return "translate(" + source.y0 + "," + source.x0 + ")"; })
              .on("click", click);

          nodeEnter.append("circle")
           .attr("r", function(d) { return d.value; })
           .style("stroke", function(d) { return d.type; })
           .style("fill", function(d) { return d.level; });

          nodeEnter.append("text")
              .attr("x", function(d) { return d.children || d._children ? -5 : -5; })
              .attr("dy", "0.35em")
              //.attr("text-anchor", function(d) { return d.children || d._children ? "end" : "start"; })
              .text(function(d) { return d.name; })
              .style("fill-opacity", 1e-6);

          // Transition nodes to their new position.
          var nodeUpdate = node.transition()
              .duration(duration)
              .attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; });

          nodeUpdate.select("circle")
            .attr("r", function(d) { return d.value; })
            .style("fill", function(d) { return d.level; });

          nodeUpdate.select("text")
              .style("fill-opacity", 1);

          // Transition exiting nodes to the parent's new position.
          var nodeExit = node.exit().transition()
              .duration(duration)
              .attr("transform", function(d) { return "translate(" + source.y + "," + source.x + ")"; })
              .remove();

          nodeExit.select("circle")
              .attr("r", 1e-6);

          nodeExit.select("text")
              .style("fill-opacity", 1e-6);

          // Update the links
          var link = svg.selectAll("path.link")
              .data(links, function(d) { return d.target.id; });

          // Enter any new links at the parent's previous position.
          link.enter().insert("path", "g")
              .attr("class", "link")
              .style("stroke", function(d) { return d.target.level; })
              .attr("d", function(d) {
                var o = {x: source.x0, y: source.y0};
                return diagonal({source: o, target: o});
              });

          // Transition links to their new position.
          link.transition()
              .duration(duration)
              .attr("d", diagonal);

          // Transition exiting nodes to the parent's new position.
          link.exit().transition()
              .duration(duration)
              .attr("d", function(d) {
                var o = {x: source.x, y: source.y};
                return diagonal({source: o, target: o});
              })
              .remove();

          // Stash the old positions for transition.
          nodes.forEach(function(d) {
            d.x0 = d.x;
            d.y0 = d.y;
          });
        }

        // Toggle children on click.
        function click(d) {
          if (d.children) {
            d._children = d.children;
            d.children = null;
          } else {
            d.children = d._children;
            d._children = null;
          }
          update(d);
        }


        function zoomed() {
            svg.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
        }

        function dragstarted(d) {
            d3.event.sourceEvent.stopPropagation();
            d3.select(this).classed("dragging", true);
        }

        function dragged(d) {
            d3.select(this).attr("x", d.x = d3.event.x).attr("y", d.y = d3.event.y);
        }

        function dragended(d) {
            d3.select(this).classed("dragging", false);
        }

    if(window.File&&window.FileReader&&window.FileList){
        function handleFileSelect(event){
            var file=event.target.files[0];
            var reader=new FileReader();
            reader.onload=function(){
                run(JSON.parse(reader.result));}
            reader.onerror=function(){
                alert("Too bad - error on loading file: "+file.name);}
            reader.readAsText(file);}
        document.getElementById('get-tree-data').
            addEventListener('change',handleFileSelect,false);}
    else{alert('Dude - your browser is too old! Do something!');}

    // Set-up the export button
    d3.select('#saveButton').on('click', function(){
        var svgcanvas = document.getElementsByTagName("svg");
        var xml = createXML(svgcanvas);

        var height = parseInt(svgcanvas[0].height);
        var width = parseInt(svgcanvas[0].width);

    });

    </script>
  </body>
</html>
